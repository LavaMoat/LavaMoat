<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>chart-csv</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.20/c3.css"
      integrity="sha384-ztqQYuF0ztQOO26+6hbRTtSQ6HGLosUJRQI9kx0L9OpJiESTtsiriiQNqwBIBl9a"
      crossorigin="anonymous"
      rel="stylesheet"
      type="text/css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
      integrity="sha384-M06Cb6r/Yrkprjr7ngOrJlzgekrkkdmGZDES/SUnkUpUol0/qjsaQWQfLzq0mcfg"
      crossorigin="anonymous"
      charset="utf-8"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.7.20/c3.min.js"
      integrity="sha384-xOzJ6ocROuPNeY/PUgXyXgiPyvvePCiWVkKXro4Lb1gWoGJOtrJw+zrpf3NBx1B5"
      crossorigin="anonymous"
    ></script>
  </head>
  <body onload="run()">
    <div id="graph"></div>

    <script>
      function parseCSV(csv) {
        return csv
          .split('\n')
          .filter(function (row) {
            return !!row.trim()
          })
          .map(function (row) {
            return row.split(',')
          })
      }

      function haveHead(csv) {
        return !/^\d+$/.test(csv[0][0])
      }

      function chart(id, csv) {
        csv = parseCSV(csv)

        var columns = []
        var showLegend = haveHead(csv)

        if (showLegend) {
          csv.shift().forEach(function (head) {
            columns.push([head])
          })
        } else {
          for (var n = 0; n < csv[0].length; n++) {
            columns.push([n])
          }
        }

        csv.forEach(function (r) {
          r.forEach(function (c, i) {
            columns[i].push(parseFloat(c, 10))
          })
        })

        var opts = {
          bindto: '#' + id,
          data: {
            // use first column as x value
            x: columns[0][0],
            columns: columns,
            type: 'line',
          },
          point: { show: false },
          axis: { x: { show: true } },
          legend: { show: showLegend },
        }

        c3.generate(opts)
      }

      function run() {
        chart('graph', csv)
      }

      var csv = `
n, node,bify,lavamoat-bify,lavamoat-node,endo-unsafe
0,0.289437006,0.243924174,0.462145639,0.93654414,0.806826983
5000,0.30575173,0.286086601,2.782789547,5.813080133,0.954900475
`
    </script>
  </body>
</html>
