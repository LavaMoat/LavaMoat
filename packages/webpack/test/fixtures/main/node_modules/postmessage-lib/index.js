function mkNotify(target) {
  
  return function notify(message, targetOrigin = "*") {
    if(!target) {
      return console.error('target is not defined')
    }
    target.postMessage('ğŸŸ¢'+message, targetOrigin);
  }
}

const tryAndReport = (examples) => {
  for (const example of examples) {
    try {
      example()
    } catch (e) {
      console.error(e)
      window?.parent?.postMessage('ğŸ›‘ in iframe: '+e, '*')
      window?.opener?.postMessage('ğŸ›‘ in popup: '+e, '*')
    }
  }
}

module.exports = {
  notifyParent: mkNotify(window.parent),
  notifyTop: mkNotify(window.top),
  notifyOpener: mkNotify(window.opener),
  abuseGlobals: () => {
    tryAndReport([
      () => window.parent.alert('global capabilities leaked in .parent'),
      () => window.parent.parent.alert('global capabilities leaked in parent.parent'),
    ])
  }
};